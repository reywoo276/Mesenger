<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Чат</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-xl">
  <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">💬 Чат</h2>

  <div class="grid grid-cols-1 gap-4 mb-4">
    <input type="text" id="sender" placeholder="Ваше имя"
           class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring focus:border-blue-400">
    <input type="text" id="recipient" placeholder="Получатель"
           class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring focus:border-blue-400">
  </div>

  <div id="chat"
       class="h-64 overflow-y-auto bg-gray-50 border border-gray-200 rounded-xl p-4 mb-4 text-sm text-gray-700 space-y-2">
    <!-- Сообщения будут здесь -->
  </div>

  <div class="flex gap-2">
    <input type="text" id="messageInput" placeholder="Введите сообщение"
           class="flex-1 px-4 py-2 border border-gray-300 rounded-xl focus:outline-none focus:ring focus:border-blue-400">
    <button onclick="sendMessage()"
            class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 transition">
      Отправить
    </button>
  </div>
</div>

<script>
  let stompClient = null;

  function connect() {
    const socket = new SockJS('/chat');
    stompClient = Stomp.over(socket);
    stompClient.connect({}, function () {
      stompClient.subscribe('/topic/messages', function (messageOutput) {
        const message = JSON.parse(messageOutput.body);
        const chat = document.getElementById('chat');
        const messageElement = document.createElement('div');
        messageElement.innerHTML = `<strong>${message.sender}:</strong> ${message.content}`;
        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight;
      });
    });
  }

  function sendMessage() {
    const sender = document.getElementById('sender').value;
    const recipient = document.getElementById('recipient').value;
    const content = document.getElementById('messageInput').value;
    if (sender && content) {
      stompClient.send("/app/send", {}, JSON.stringify({sender, recipient, content}));
      document.getElementById('messageInput').value = '';
    }
  }

  connect();
</script>

</body>
</html>
